<launch>
    <arg name="map_size_x_" />
    <arg name="map_size_y_" />
    <arg name="map_size_z_" />

    <arg name="odometry_topic" />
    <arg name="cloud_topic" />

    <arg name="max_vel" />
    <arg name="max_acc" />
    <arg name="planning_horizon" />

    <arg name="point_num" />
    <arg name="point0_x" />
    <arg name="point0_y" />
    <arg name="point0_z" />
    <arg name="point1_x" />
    <arg name="point1_y" />
    <arg name="point1_z" />
    <arg name="point2_x" />
    <arg name="point2_y" />
    <arg name="point2_z" />
    <arg name="point3_x" />
    <arg name="point3_y" />
    <arg name="point3_z" />
    <arg name="point4_x" />
    <arg name="point4_y" />
    <arg name="point4_z" />

    <arg name="flight_type" />
    <arg name="use_distinctive_trajs" />

    <arg name="obj_num_set" />

    <arg name="drone_id" />


    <!-- main node -->
    <!-- <node pkg="ego_planner" name="ego_planner_node" type="ego_planner_node" output="screen"
    launch-prefix="valgrind"> -->
    <node pkg="plan_manage" name="drone_$(arg drone_id)_node" type="planner_node"
        output="screen">

        <remap from="/odom_world" to="/drone_$(arg drone_id)_$(arg odometry_topic)" />
        <remap from="/planning/bspline" to="/drone_$(arg drone_id)_planning/bspline" />
        <remap from="/planning/data_display" to="/drone_$(arg drone_id)_planning/data_display" />
        <!-- <remap from="~planning/broadcast_bspline_from_planner" to="/broadcast_bspline" /> -->
        <!-- <remap from="~planning/broadcast_bspline_to_planner" to="/broadcast_bspline" /> -->

        <!-- <remap from="~grid_map/odom" to="/drone_$(arg drone_id)_$(arg odometry_topic)" />
        <remap from="~grid_map/cloud" to="/drone_$(arg drone_id)_$(arg cloud_topic)" />
        <remap from="~grid_map/pose" to="/drone_$(arg drone_id)_$(arg camera_pose_topic)" />
        <remap from="~grid_map/depth" to="/drone_$(arg drone_id)_$(arg depth_topic)" />
        <remap from="~dsp_map/cloud" to="/drone_$(arg drone_id)_pcl_render_node/cloud" />
        <remap from="~dsp_map/pose" to="/drone_$(arg drone_id)_odom_visualization/pose" /> -->


        <!-- planning fsm -->
        <param name="fsm/flight_type" value="$(arg flight_type)" type="int" />
        <param name="fsm/thresh_replan" value="1.0" type="double" />
        <param name="fsm/thresh_no_replan" value="1.0" type="double" />
        <param name="fsm/planning_horizon" value="$(arg planning_horizon)" type="double" /> <!--always set to 1.5 times grater than sensing horizen-->
        <param name="fsm/planning_horizen_time" value="3" type="double" />
        <param name="fsm/emergency_time" value="1.0" type="double" />
        <param name="fsm/realworld_experiment" value="false" />
        <param name="fsm/fail_safe" value="true" />
        <param name="fsm/traj_risk_thresh" value="0.5" />
        
        
        <param name="fsm/waypoint_num" value="$(arg point_num)" type="int" />
        <param name="fsm/waypoint0_x" value="$(arg point0_x)" type="double" />
        <param name="fsm/waypoint0_y" value="$(arg point0_y)" type="double" />
        <param name="fsm/waypoint0_z" value="$(arg point0_z)" type="double" />
        <param name="fsm/waypoint1_x" value="$(arg point1_x)" type="double" />
        <param name="fsm/waypoint1_y" value="$(arg point1_y)" type="double" />
        <param name="fsm/waypoint1_z" value="$(arg point1_z)" type="double" />
        <param name="fsm/waypoint2_x" value="$(arg point2_x)" type="double" />
        <param name="fsm/waypoint2_y" value="$(arg point2_y)" type="double" />
        <param name="fsm/waypoint2_z" value="$(arg point2_z)" type="double" />
        <param name="fsm/waypoint3_x" value="$(arg point3_x)" type="double" />
        <param name="fsm/waypoint3_y" value="$(arg point3_y)" type="double" />
        <param name="fsm/waypoint3_z" value="$(arg point3_z)" type="double" />
        <param name="fsm/waypoint4_x" value="$(arg point4_x)" type="double" />
        <param name="fsm/waypoint4_y" value="$(arg point4_y)" type="double" />
        <param name="fsm/waypoint4_z" value="$(arg point4_z)" type="double" />

        <!-- particle map -->
        <param name="particle_map/pose_type" value="2" type="int"/>
        <param name="particle_map/frame_id" value="world" type="string"/>
        <param name="particle_map/odom_lidar_timeout" value="0.35" type="double"/>
        <param name="particle_map/local_update_range_x" value="5" type="double"/>
        <param name="particle_map/local_update_range_y" value="5" type="double"/>
        <param name="particle_map/local_update_range_z" value="1.5" type="double"/>
        <param name="particle_map/inf_grid" value="1" type="int"/>
        <param name="particle_map/enable_virtual_wall" value="false" type="bool"/>
        <param name="particle_map/virtual_ceil" type="double" value="10"/>
        <param name="particle_map/virtual_ground" type="double" value="0"/>
        <param name="particle_map/half_fov_horizontal" type="double" value="180"/>
        <param name="particle_map/half_fov_vertical" type="double" value="50"/>
        <param name="particle_map/lidar_topic" type="string" value="/dynamic_map_generator/local_cloud"/>
        <param name="particle_map/pose_topic" type="string" value="pose"/>
        <param name="particle_map/odom_topic" type="string" value="/drone_$(arg drone_id)_odometry"/>
        <param name="particle_map/occupancy_thresh" value="0.5" type="double"/>
        <param name="particle_map/risk_thresh" value = "0.05" type="double"/>
        <param name="particle_map/enable_future_prediction" value="false" type="bool"/>
        <param name="particle_map/prediction_z_height" value="0.2" type="double"/>
        <param name="particle_map/prediction_y_offset" value="25" type="double"/>
        <param name="particle_map/dynamic_cluster_max_center_height" value="20.0" type="double"/>
        <param name="particle_map/dynamic_cluster_max_point_num" value="2008" type="int"/>
        <param name="particle_map/position_prediction_stddev" type="double" value="0.05"/>
        <param name="particle_map/velocity_prediction_stddev" type="double" value="0.05"/>
        <param name="particle_map/new_born_particle_weight" type="double" value="0.0001"/>
        <param name="particle_map/new_born_particle_number_each_point" type="int" value="15"/>
        <param name="particle_map/voxel_filter_resolution" type="double" value="0.2"/>
        <param name="particle_map/sigma_ob" type="double" value="0.1"/>
        
        <!-- planner manager -->
        <param name="manager/max_vel" value="$(arg max_vel)" type="double" />
        <param name="manager/max_acc" value="$(arg max_acc)" type="double" />
        <param name="manager/max_jerk" value="4" type="double" />
        <param name="manager/control_points_distance" value="0.4" type="double" />
        <param name="manager/feasibility_tolerance" value="0.05" type="double" />
        <param name="manager/planning_horizon" value="$(arg planning_horizon)" type="double" />
        <param name="manager/use_distinctive_trajs" value="$(arg use_distinctive_trajs)" type="bool" />
        <param name="manager/drone_id" value="$(arg drone_id)" />
        <param name="manager/risk_weight" value="100.0" />


        <!-- topo prm -->
        <param name="topo_prm/sample_inflate_x" value="1.0" type="double"/>
        <param name="topo_prm/sample_inflate_y" value="3.5" type="double"/>
        <param name="topo_prm/sample_inflate_z" value="1.0" type="double"/>
        <param name="topo_prm/clearance" value="0.3" type="double"/>
        <param name="topo_prm/max_sample_time" value="0.005" type="double"/>
        <param name="topo_prm/max_sample_num" value="2000" type="int"/>
        <param name="topo_prm/max_raw_path" value="300" type="int"/>
        <param name="topo_prm/max_raw_path2" value="25" type="int"/>
        <param name="topo_prm/short_cut_num" value="1" type="int"/>
        <param name="topo_prm/reserve_num" value="4" type="int"/>
        <param name="topo_prm/ratio_to_short" value="5.5" type="double"/>
        <param name="topo_prm/parallel_shortcut" value="false" type="bool"/>
        <!-- <param name="topo_prm/risk_thresh" value="0.05" type="double"/> -->
        <param name="topo_prm/init_x" value="-10" type="double"/>
        <param name="topo_prm/init_y" value="0" type="double"/>
        <param name="topo_prm/init_z" value="2.0" type="double"/>


        <!-- trajectory optimization -->
        <!-- trajectory optimization -->
        <param name="optimization/lambda1_smooth" value="1.0" type="double"/>
        <param name="optimization/lambda1_guide" value="1.5" type="double"/>
        <param name="optimization/lambda1_feasibility" value="0.1" type="double"/>
        <param name="optimization/lambda2_smooth" value="1.0" type="double"/>
        <param name="optimization/lambda2_feasibility" value="0.5" type="double"/>
        <param name="optimization/lambda2_fitness" value="1.0" type="double"/>
        <param name="optimization/dist0" value="0.5" type="double"/>
        <param name="optimization/max_vel" value="$(arg max_vel)" type="double"/>
        <param name="optimization/max_acc" value="$(arg max_acc)" type="double"/>

        <param name="bspline/limit_vel" value="$(arg max_vel)" type="double" />
        <param name="bspline/limit_acc" value="$(arg max_acc)" type="double" />
        <param name="bspline/limit_ratio" value="1.1" type="double" />

        <remap from="~planning/bspline_traj" to="drone_$(arg drone_id)_planning/bspline"/> 

        <!-- objects prediction -->
        <!-- <param name="prediction/obj_num" value="$(arg obj_num_set)" type="int" /> -->
        <!-- <param name="prediction/lambda" value="1.0" type="double" /> -->
        <!-- <param name="prediction/predict_rate" value="1.0" type="double" /> -->


    </node>




</launch>